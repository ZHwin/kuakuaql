# 通知配置说明

## 🎯 问题说明

每次从 git 拉取更新时，`sendNotify.js` 会被覆盖，导致本地配置的通知信息丢失。

## ✅ 解决方案

本项目已实现配置文件分离，你的通知配置不会再被覆盖！

### 配置优先级

```
本地配置文件 > 环境变量 > 默认配置
```

## 📝 使用方法

### 方法一：本地配置文件（推荐）

适用于本地运行或需要保存配置的场景。

**步骤：**

1. 复制配置示例文件：
   ```bash
   # Windows
   copy sendNotify.config.example.js sendNotify.config.js
   
   # Linux/Mac
   cp sendNotify.config.example.js sendNotify.config.js
   ```

2. 编辑 `sendNotify.config.js`，填入你的配置：
   ```javascript
   module.exports = {
     PUSH_KEY: '你的Server酱Key',
     BARK_PUSH: 'https://api.day.app/你的设备码/',
     // ... 其他配置
   };
   ```

3. 保存文件，运行脚本即可

**优点：**
- ✅ 配置不会被 git 更新覆盖
- ✅ 可以保存多个推送渠道
- ✅ 配置清晰，易于管理

**注意：**
- `sendNotify.config.js` 已加入 `.gitignore`，不会被提交到 git
- 每次 git pull 后，你的配置文件都会保留

### 方法二：环境变量（青龙面板推荐）

适用于青龙面板等容器化环境。

**步骤：**

在青龙面板 → 环境变量中添加：

```
名称: PUSH_KEY
值: 你的Server酱Key

名称: BARK_PUSH
值: https://api.day.app/你的设备码/

名称: TG_BOT_TOKEN
值: 你的Telegram Bot Token

名称: TG_USER_ID
值: 你的Telegram User ID
```

**优点：**
- ✅ 适合容器化部署
- ✅ 多个脚本共享配置
- ✅ 便于集中管理

### 方法三：直接修改 sendNotify.js（不推荐）

如果你坚持要直接修改 `sendNotify.js`：

1. 修改前先备份：
   ```bash
   cp sendNotify.js sendNotify.js.backup
   ```

2. 每次 git pull 后恢复配置：
   ```bash
   # 方式1：手动合并
   # 对比差异，手动复制配置
   
   # 方式2：使用 git stash
   git stash              # 暂存本地修改
   git pull               # 拉取更新
   git stash pop          # 恢复本地修改（可能有冲突）
   ```

**缺点：**
- ❌ 容易被覆盖
- ❌ 可能产生 git 冲突
- ❌ 不便于维护

## 🔧 支持的推送方式

### 1. Server酱
```javascript
PUSH_KEY: '你的PUSH_KEY'
```
官网：https://sct.ftqq.com/

### 2. Bark（iOS）
```javascript
BARK_PUSH: 'https://api.day.app/你的设备码/'
```

### 3. PushPlus
```javascript
PUSH_PLUS_TOKEN: '你的token',
PUSH_PLUS_USER: '群组编码（可选）'
```
官网：https://www.pushplus.plus/

### 4. 企业微信机器人
```javascript
QYWX_KEY: '你的webhook地址'
```

### 5. Telegram Bot
```javascript
TG_BOT_TOKEN: '你的bot_token',
TG_USER_ID: '你的user_id'
```

### 6. WxPusher
```javascript
WXPUSHER_APP_TOKEN: '你的appToken',
WXPUSHER_UIDS: '用户ID，多个用;分隔'
```
官网：https://wxpusher.zjiecode.com/

### 7. 钉钉机器人
```javascript
DD_BOT_TOKEN: '你的token',
DD_BOT_SECRET: '你的secret'
```

### 8. 飞书机器人
```javascript
FSKEY: '你的key'
```

### 9. 邮件推送
```javascript
SMTP_SERVICE: 'QQ',  // 或 126、163、Gmail
SMTP_EMAIL: 'your@email.com',
SMTP_PASSWORD: '你的密码或授权码',
SMTP_NAME: '发件人名称'
```

### 10. 自定义 Webhook
```javascript
WEBHOOK_URL: 'https://your-webhook-url.com',
WEBHOOK_METHOD: 'POST',
WEBHOOK_BODY: '{"text":"{{title}}\n{{content}}"}',
WEBHOOK_HEADERS: '{"Content-Type":"application/json"}'
```

## 🧪 测试配置

创建测试脚本 `test-notify.js`：

```javascript
const notify = require('./sendNotify');

(async () => {
  await notify.sendNotify('测试通知', '这是一条测试消息，如果收到说明配置成功！');
})();
```

运行测试：
```bash
node test-notify.js
```

## ❓ 常见问题

### 1. 配置文件不生效？
检查文件名是否正确：`sendNotify.config.js`（不是 .example）

### 2. 多个推送渠道同时配置？
可以！脚本会同时向所有配置的渠道发送通知。

### 3. 青龙面板如何配置？
使用环境变量方式，不需要创建配置文件。

### 4. 如何关闭通知？
在脚本中设置 `Notify = 0` 或删除所有推送配置。

### 5. git pull 后配置丢失？
检查是否使用了本地配置文件方式，确认 `sendNotify.config.js` 存在。

## 📚 更多帮助

- 查看 `sendNotify.config.example.js` 了解所有配置项
- 查看 `青龙面板使用说明.md` 了解青龙面板配置
- 遇到问题请提交 Issue

---

**配置一次，永久生效！** 🎉
